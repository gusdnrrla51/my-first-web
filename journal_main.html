<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•˜ë£¨í•œì¤„ â€” íŒŒì¼ëŸ¿</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans KR', sans-serif; -webkit-font-smoothing: antialiased; }
    input, textarea, button, select { font-family: inherit; }
    @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect, useCallback, createContext, useContext } = React;

    // â•â•â• Design Tokens â•â•â•
    const T = {
      bg:"#F5F0E8",card:"#FFFCF7",accent:"#B8956A",accentLight:"#D4B896",
      accentBg:"#F0E6D6",text:"#4A3728",textSub:"#8B7355",border:"#E8DFD0",
      hover:"#EDE5D8",shadow:"0 2px 12px rgba(139,115,85,0.08)",
      shadowHover:"0 6px 24px rgba(139,115,85,0.14)",
      gradient:"linear-gradient(135deg,#B8956A,#9B7B5A)",
      input:"#F0EBE1",divider:"#E5DDD0",textMuted:"#A89F90",
      danger:"#C97064",success:"#8DB580",
    };

    const EMOTIONS = {
      happy:{emoji:"ğŸ˜Š",label:"í–‰ë³µ",color:"#E8A87C"},sad:{emoji:"ğŸ˜¢",label:"ìŠ¬í””",color:"#8BA4B8"},
      angry:{emoji:"ğŸ˜ ",label:"ë¶„ë…¸",color:"#C97064"},anxious:{emoji:"ğŸ˜°",label:"ë¶ˆì•ˆ",color:"#A688B0"},
      peaceful:{emoji:"ğŸ˜Œ",label:"í‰ì˜¨",color:"#8DB580"},excited:{emoji:"ğŸ¤©",label:"ì„¤ë ˜",color:"#D4897C"},
      tired:{emoji:"ğŸ˜´",label:"í”¼ê³¤",color:"#A0998E"},grateful:{emoji:"ğŸ¥°",label:"ê°ì‚¬",color:"#C4A265"},
      lonely:{emoji:"ğŸ¥º",label:"ì™¸ë¡œì›€",color:"#9678A0"},proud:{emoji:"ğŸ’ª",label:"ë¿Œë“¯",color:"#C49555"},
    };
    const EMO_KEYS = Object.keys(EMOTIONS);
    const ACTIVITIES = ["ğŸƒ ìš´ë™","ğŸ“š ë…ì„œ","ğŸµ ìŒì•…","ğŸ³ ìš”ë¦¬","ğŸ® ê²Œì„","â˜• ì¹´í˜","ğŸ¬ ì˜í™”","ğŸ’» ì½”ë”©","ğŸ§˜ ëª…ìƒ","ğŸ“¸ ì‚¬ì§„","ğŸ›’ ì‡¼í•‘","ğŸ‘¥ ëª¨ì„","ğŸš¶ ì‚°ì±…","ğŸ  ì§‘"];
    const INTENSITY = ["ì•½í•¨","ë³´í†µ","ê°•í•¨","ë§¤ìš° ê°•í•¨"];

    const today = () => new Date().toISOString().slice(0,10);
    const fmt = d => { const x = new Date(d+"T00:00:00"); const w=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; return `${x.getFullYear()}.${x.getMonth()+1}.${x.getDate()} (${w[x.getDay()]})`; };
    const fmtTitle = d => { const x = new Date(d+"T00:00:00"); const w=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "]; return `${x.getFullYear()}ë…„ ${x.getMonth()+1}ì›” ${x.getDate()}ì¼ ${w[x.getDay()]}ìš”ì¼`; };
    const money = n => (n||0).toLocaleString()+"ì›";
    const isToday = d => d===today();

    // â•â•â• Auth Context â•â•â•
    const AuthCtx = createContext(null);
    const useAuth = () => useContext(AuthCtx);

    function AuthProvider({children}) {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      useEffect(() => {
        const saved = null; // simulate check
        setTimeout(() => setLoading(false), 800);
      }, []);
      const login = (provider, email, pw) => {
        setLoading(true);
        setTimeout(() => {
          setUser({ name: provider === "email" ? email.split("@")[0] : provider === "kakao" ? "ì¹´ì¹´ì˜¤ ì‚¬ìš©ì" : provider === "google" ? "Google User" : "Apple User", email: email || `${provider}@example.com`, provider, avatar: null, joinDate: "2026-01-01" });
          setLoading(false);
        }, 1200);
      };
      const signup = (email, pw, name) => {
        setLoading(true);
        setTimeout(() => {
          setUser({ name, email, provider:"email", avatar:null, joinDate:today() });
          setLoading(false);
        }, 1200);
      };
      const logout = () => setUser(null);
      return <AuthCtx.Provider value={{user,loading,login,signup,logout}}>{children}</AuthCtx.Provider>;
    }

    // â•â•â• Mock Data â•â•â•
    const INIT_DIARIES = [
      { id:1, date:"2026-02-12", title:"ë´„ì´ ì˜¤ëŠ” ëŠë‚Œì˜ í•˜ë£¨", emotions:[{key:"happy",intensity:4},{key:"grateful",intensity:3},{key:"peaceful",intensity:2}], places:[{name:"í•œë‚¨ë™ ì¹´í˜",isFirst:false},{name:"ì´íƒœì› ê³¨ëª©ê¸¸",isFirst:true}], payments:[{store:"ì¹´í˜ ì˜¨ë„",amount:8500,category:"ì¹´í˜"},{store:"ì´íƒœì› íŒŒìŠ¤íƒ€ì§‘",amount:36500,category:"ì™¸ì‹"}], activities:["â˜• ì¹´í˜","ğŸ“¸ ì‚¬ì§„"], steps:8234, content:"ì˜¤ëŠ˜ì€ ë‚ ì”¨ê°€ ìœ ë‚œíˆ ë”°ëœ»í–ˆë‹¤.\n\ní•œë‚¨ë™ ì¹´í˜ì—ì„œ ë¼ë–¼ë¥¼ ë§ˆì‹œë©´ì„œ ì°½ë°–ì„ ë°”ë¼ë´¤ë‹¤.\n\nì˜¤í›„ì—ëŠ” ì´íƒœì› ê³¨ëª©ê¸¸ì„ ì²˜ìŒ ê±¸ì–´ë´¤ë‹¤. ë‹¤ìŒì—ë„ ê¼­ ë‹¤ì‹œ ì˜¤ê³  ì‹¶ë‹¤." },
      { id:2, date:"2026-02-11", title:"íšŒì‚¬ì—ì„œ ì¢‹ì€ í”¼ë“œë°±ì„ ë°›ì€ ë‚ ", emotions:[{key:"proud",intensity:4},{key:"happy",intensity:3},{key:"excited",intensity:2}], places:[{name:"ê°•ë‚¨ ì˜¤í”¼ìŠ¤",isFirst:false},{name:"ì—­ì‚¼ë™ ë§›ì§‘",isFirst:true}], payments:[{store:"ì—­ì‚¼ ì´ˆë°¥ì§‘",amount:25000,category:"ì™¸ì‹"},{store:"í¸ì˜ì ",amount:7000,category:"í¸ì˜ì "}], activities:["ğŸ’» ì½”ë”©","ğŸ‘¥ ëª¨ì„"], steps:6102, content:"í”„ë¡œì íŠ¸ ë°œí‘œë¥¼ í–ˆëŠ”ë° íŒ€ì¥ë‹˜ì´ ì •ë§ ì˜í–ˆë‹¤ê³  ì¹­ì°¬í•´ì£¼ì…¨ë‹¤." },
      { id:3, date:"2026-02-10", title:"ë¹„ ì˜¤ëŠ” ì¼ìš”ì¼", emotions:[{key:"peaceful",intensity:3},{key:"sad",intensity:2},{key:"lonely",intensity:2}], places:[{name:"ì§‘",isFirst:false},{name:"ë™ë„¤ í¸ì˜ì ",isFirst:false}], payments:[{store:"í¸ì˜ì ",amount:8000,category:"í¸ì˜ì "}], activities:["ğŸ¬ ì˜í™”","ğŸ  ì§‘"], steps:1820, content:"ë¹„ê°€ ë§ì´ ì™€ì„œ í•˜ë£¨ì¢…ì¼ ì§‘ì— ìˆì—ˆë‹¤. ë„·í”Œë¦­ìŠ¤ë¥¼ ë³´ë©´ì„œ ì‰¬ì—ˆë‹¤." },
      { id:4, date:"2026-02-09", title:"ì¹œêµ¬ë“¤ê³¼ ì‹ ë‚˜ëŠ” í† ìš”ì¼", emotions:[{key:"happy",intensity:4},{key:"excited",intensity:4},{key:"grateful",intensity:3}], places:[{name:"í™ëŒ€ í´ëŸ½ê±°ë¦¬",isFirst:false},{name:"ì—°ë‚¨ë™ ë¸ŒëŸ°ì¹˜ì¹´í˜",isFirst:true},{name:"ë§ì› í•œê°•ê³µì›",isFirst:false}], payments:[{store:"ë¸ŒëŸ°ì¹˜ì¹´í˜",amount:32000,category:"ì¹´í˜"},{store:"í™ëŒ€ ìˆ ì§‘",amount:57000,category:"ìœ í¥"}], activities:["â˜• ì¹´í˜","ğŸ‘¥ ëª¨ì„","ğŸš¶ ì‚°ì±…"], steps:12450, content:"ì˜¤ëœë§Œì— ëŒ€í•™êµ ì¹œêµ¬ë“¤ì„ ë§Œë‚¬ë‹¤. ë¸ŒëŸ°ì¹˜ ë¨¹ê³  í•œê°• ì‚°ì±…í•˜ê³  ì •ë§ ì¬ë°Œì—ˆë‹¤." },
      { id:5, date:"2026-02-08", title:"ì•¼ê·¼í•˜ëŠ” ê¸ˆìš”ì¼", emotions:[{key:"tired",intensity:4},{key:"anxious",intensity:3}], places:[{name:"ê°•ë‚¨ ì˜¤í”¼ìŠ¤",isFirst:false}], payments:[{store:"ë°°ë‹¬ì˜ë¯¼ì¡±",amount:15000,category:"ì™¸ì‹"}], activities:["ğŸ’» ì½”ë”©"], steps:3200, content:"ë°ë“œë¼ì¸ì´ ë‹¤ê°€ì™€ì„œ ì•¼ê·¼ì„ í–ˆë‹¤. í”¼ê³¤í•˜ì§€ë§Œ ë³´ëŒì°¼ë‹¤." },
    ];

    // â•â•â• Login Page â•â•â•
    function LoginPage() {
      const {login, signup, loading} = useAuth();
      const [mode, setMode] = useState("login");
      const [email, setEmail] = useState("");
      const [pw, setPw] = useState("");
      const [name, setName] = useState("");
      const [pwConfirm, setPwConfirm] = useState("");
      const [showPw, setShowPw] = useState(false);
      const [error, setError] = useState("");
      const [agreeTerms, setAgreeTerms] = useState(false);
      const [agreePrivacy, setAgreePrivacy] = useState(false);

      const handleLogin = () => {
        setError("");
        if (!email.trim()) return setError("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (!pw.trim()) return setError("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (pw.length < 6) return setError("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
        login("email", email, pw);
      };

      const handleSignup = () => {
        setError("");
        if (!name.trim()) return setError("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (!email.trim()) return setError("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (!email.includes("@")) return setError("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
        if (pw.length < 6) return setError("ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
        if (pw !== pwConfirm) return setError("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        if (!agreeTerms || !agreePrivacy) return setError("í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.");
        signup(email, pw, name);
      };

      const inputStyle = {
        width:"100%",padding:"14px 16px",borderRadius:12,border:`1.5px solid ${T.border}`,
        background:T.card,fontSize:14,color:T.text,outline:"none",boxSizing:"border-box",
        transition:"border 0.2s",fontFamily:"inherit",
      };

      if (loading) return (
        <div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}}>
          <div style={{textAlign:"center"}}>
            <div style={{fontSize:56,marginBottom:16,animation:"pulse 1.5s infinite"}}>ğŸ“–</div>
            <div style={{fontSize:15,color:T.textSub,fontWeight:500}}>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
          </div>
        </div>
      );

      return (
        <div style={{minHeight:"100vh",background:`linear-gradient(180deg, ${T.bg} 0%, #EDE5D8 100%)`,display:"flex",alignItems:"center",justifyContent:"center",padding:20,fontFamily:"'Noto Sans KR',sans-serif"}}>
          <div style={{width:"100%",maxWidth:420,background:T.card,borderRadius:24,padding:"48px 36px",boxShadow:"0 8px 40px rgba(139,115,85,0.12)"}}>
            {/* Logo */}
            <div style={{textAlign:"center",marginBottom:36}}>
              <div style={{fontSize:48,marginBottom:8}}>ğŸ“–</div>
              <div style={{fontSize:24,fontWeight:800,color:T.text,letterSpacing:-0.5}}>í•˜ë£¨í•œì¤„</div>
              <div style={{fontSize:13,color:T.textSub,marginTop:4}}>ë§¤ì¼ í•œ ì¤„ë¡œ ê¸°ë¡í•˜ëŠ” ë‚˜ì˜ í•˜ë£¨</div>
            </div>

            {mode === "login" && (
              <>
                {/* Social Login */}
                <div style={{display:"flex",flexDirection:"column",gap:10,marginBottom:24}}>
                  <button onClick={()=>login("kakao","kakao@user.com","")} style={{padding:"13px 16px",borderRadius:12,border:"none",background:"#FEE500",color:"#191919",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                    <span style={{fontSize:18}}>ğŸ’¬</span> ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°
                  </button>
                  <button onClick={()=>login("google","google@user.com","")} style={{padding:"13px 16px",borderRadius:12,border:`1.5px solid ${T.border}`,background:T.card,color:T.text,fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                    <span style={{fontSize:16}}>G</span> Googleë¡œ ì‹œì‘í•˜ê¸°
                  </button>
                  <button onClick={()=>login("apple","apple@user.com","")} style={{padding:"13px 16px",borderRadius:12,border:"none",background:"#000",color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8}}>
                    <span style={{fontSize:16}}>ğŸ</span> Appleë¡œ ì‹œì‘í•˜ê¸°
                  </button>
                </div>

                {/* Divider */}
                <div style={{display:"flex",alignItems:"center",gap:12,margin:"20px 0"}}>
                  <div style={{flex:1,height:1,background:T.border}}/>
                  <span style={{fontSize:12,color:T.textSub}}>ë˜ëŠ” ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸</span>
                  <div style={{flex:1,height:1,background:T.border}}/>
                </div>

                {/* Email Login */}
                <div style={{display:"flex",flexDirection:"column",gap:12}}>
                  <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="ì´ë©”ì¼" type="email" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                  <div style={{position:"relative"}}>
                    <input value={pw} onChange={e=>setPw(e.target.value)} placeholder="ë¹„ë°€ë²ˆí˜¸" type={showPw?"text":"password"} style={inputStyle} onKeyDown={e=>e.key==="Enter"&&handleLogin()} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                    <button onClick={()=>setShowPw(!showPw)} style={{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",fontSize:16,color:T.textSub}}>{showPw?"ğŸ™ˆ":"ğŸ‘ï¸"}</button>
                  </div>
                </div>

                {error && <div style={{marginTop:10,padding:"10px 14px",borderRadius:10,background:"#FFF0EE",color:T.danger,fontSize:13,fontWeight:500}}>{error}</div>}

                <button onClick={handleLogin} style={{width:"100%",padding:15,borderRadius:12,border:"none",background:T.gradient,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer",marginTop:16,boxShadow:`0 4px 16px ${T.accent}44`,transition:"transform 0.1s"}} onMouseDown={e=>e.target.style.transform="scale(0.98)"} onMouseUp={e=>e.target.style.transform="scale(1)"}>
                  ë¡œê·¸ì¸
                </button>

                <div style={{display:"flex",justifyContent:"space-between",marginTop:16}}>
                  <button onClick={()=>{setMode("forgot");setError("");}} style={{background:"none",border:"none",color:T.textSub,fontSize:13,cursor:"pointer",textDecoration:"underline"}}>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
                  <button onClick={()=>{setMode("signup");setError("");}} style={{background:"none",border:"none",color:T.accent,fontSize:13,fontWeight:600,cursor:"pointer"}}>íšŒì›ê°€ì…</button>
                </div>
              </>
            )}

            {mode === "signup" && (
              <>
                <div style={{fontSize:18,fontWeight:700,color:T.text,marginBottom:20}}>íšŒì›ê°€ì…</div>
                <div style={{display:"flex",flexDirection:"column",gap:12}}>
                  <input value={name} onChange={e=>setName(e.target.value)} placeholder="ì´ë¦„" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                  <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="ì´ë©”ì¼" type="email" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                  <input value={pw} onChange={e=>setPw(e.target.value)} placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" type="password" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                  <input value={pwConfirm} onChange={e=>setPwConfirm(e.target.value)} placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" type="password" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                </div>
                {/* Terms */}
                <div style={{marginTop:16,display:"flex",flexDirection:"column",gap:8}}>
                  <label style={{display:"flex",alignItems:"center",gap:8,fontSize:13,color:T.text,cursor:"pointer"}}>
                    <input type="checkbox" checked={agreeTerms} onChange={e=>setAgreeTerms(e.target.checked)} style={{accentColor:T.accent}}/> <span style={{color:T.danger,fontWeight:700}}>[í•„ìˆ˜]</span> ì´ìš©ì•½ê´€ ë™ì˜
                  </label>
                  <label style={{display:"flex",alignItems:"center",gap:8,fontSize:13,color:T.text,cursor:"pointer"}}>
                    <input type="checkbox" checked={agreePrivacy} onChange={e=>setAgreePrivacy(e.target.checked)} style={{accentColor:T.accent}}/> <span style={{color:T.danger,fontWeight:700}}>[í•„ìˆ˜]</span> ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ë™ì˜
                  </label>
                </div>
                {error && <div style={{marginTop:10,padding:"10px 14px",borderRadius:10,background:"#FFF0EE",color:T.danger,fontSize:13,fontWeight:500}}>{error}</div>}
                <button onClick={handleSignup} style={{width:"100%",padding:15,borderRadius:12,border:"none",background:T.gradient,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer",marginTop:16,boxShadow:`0 4px 16px ${T.accent}44`}}>ê°€ì…í•˜ê¸°</button>
                <button onClick={()=>{setMode("login");setError("");}} style={{width:"100%",padding:12,background:"none",border:"none",color:T.textSub,fontSize:13,cursor:"pointer",marginTop:8}}>â† ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
              </>
            )}

            {mode === "forgot" && (
              <>
                <div style={{fontSize:18,fontWeight:700,color:T.text,marginBottom:8}}>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</div>
                <div style={{fontSize:13,color:T.textSub,marginBottom:20}}>ê°€ì…í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì‹œë©´ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ë³´ë‚´ë“œë ¤ìš”.</div>
                <input value={email} onChange={e=>setEmail(e.target.value)} placeholder="ì´ë©”ì¼" type="email" style={inputStyle} onFocus={e=>e.target.style.border=`1.5px solid ${T.accent}`} onBlur={e=>e.target.style.border=`1.5px solid ${T.border}`}/>
                <button onClick={()=>{if(!email.includes("@")){setError("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return;}setError("");alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì´ë©”ì¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.");setMode("login");}} style={{width:"100%",padding:15,borderRadius:12,border:"none",background:T.gradient,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer",marginTop:16}}>ì¬ì„¤ì • ë§í¬ ë³´ë‚´ê¸°</button>
                {error && <div style={{marginTop:10,padding:"10px 14px",borderRadius:10,background:"#FFF0EE",color:T.danger,fontSize:13}}>{error}</div>}
                <button onClick={()=>{setMode("login");setError("");}} style={{width:"100%",padding:12,background:"none",border:"none",color:T.textSub,fontSize:13,cursor:"pointer",marginTop:8}}>â† ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
              </>
            )}
          </div>
        </div>
      );
    }

    // â•â•â• Diary Write Page â•â•â•
    function DiaryWritePage({onSave, onCancel, editData}) {
      const [title, setTitle] = useState(editData?.title||"");
      const [content, setContent] = useState(editData?.content||"");
      const [selEmotions, setSelEmotions] = useState(editData?.emotions||[]);
      const [selActivities, setSelActivities] = useState(editData?.activities||[]);
      const [places, setPlaces] = useState(editData?.places||[]);
      const [newPlace, setNewPlace] = useState("");
      const [payments, setPayments] = useState(editData?.payments||[]);
      const [tab, setTab] = useState("emotion");

      const toggleEmo = k => {
        const exists = selEmotions.find(e=>e.key===k);
        if (exists) setSelEmotions(selEmotions.filter(e=>e.key!==k));
        else if (selEmotions.length<5) setSelEmotions([...selEmotions,{key:k,intensity:2}]);
      };
      const setIntensity = (k,v) => setSelEmotions(selEmotions.map(e=>e.key===k?{...e,intensity:v}:e));
      const toggleAct = a => setSelActivities(selActivities.includes(a)?selActivities.filter(x=>x!==a):[...selActivities,a]);
      const addPlace = () => { if(newPlace.trim()){setPlaces([...places,{name:newPlace.trim(),isFirst:false}]);setNewPlace("");} };
      const addPayment = () => setPayments([...payments,{store:"",amount:0,category:"ê¸°íƒ€"}]);

      const handleSave = () => {
        if(!title.trim()||!content.trim()||selEmotions.length===0) { alert("ì œëª©, ë‚´ìš©, ê°ì •ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        onSave({ title, content, emotions:selEmotions, activities:selActivities, places, payments:payments.filter(p=>p.store), steps:Math.floor(Math.random()*10000)+2000, date:today() });
      };

      const sec = {background:T.card,borderRadius:16,padding:"20px 24px",marginBottom:16,boxShadow:T.shadow};

      return (
        <div style={{maxWidth:700,margin:"0 auto",padding:"32px 20px"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24}}>
            <button onClick={onCancel} style={{background:"none",border:"none",color:T.textSub,fontSize:14,cursor:"pointer"}}>â† ëŒì•„ê°€ê¸°</button>
            <div style={{fontSize:18,fontWeight:700,color:T.text}}>{editData?"ì¼ê¸° ìˆ˜ì •":"ì˜¤ëŠ˜ì˜ ì¼ê¸°"}</div>
            <button onClick={handleSave} style={{background:T.accent,color:"#fff",border:"none",borderRadius:10,padding:"8px 20px",fontSize:14,fontWeight:600,cursor:"pointer"}}>ì €ì¥</button>
          </div>
          <div style={{fontSize:13,color:T.textSub,textAlign:"center",marginBottom:20}}>{fmtTitle(today())}</div>

          {/* Title */}
          <div style={sec}>
            <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:10}}>ì œëª©</div>
            <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ í•œ ì¤„ë¡œ í‘œí˜„í•´ë³´ì„¸ìš”" style={{width:"100%",padding:"12px 16px",borderRadius:12,border:`1px solid ${T.border}`,background:T.bg,fontSize:14,color:T.text,outline:"none",boxSizing:"border-box"}}/>
          </div>

          {/* Content */}
          <div style={sec}>
            <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:10}}>ì˜¤ëŠ˜ì˜ ì´ì•¼ê¸°</div>
            <textarea value={content} onChange={e=>setContent(e.target.value)} placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”..." rows={6} style={{width:"100%",padding:"12px 16px",borderRadius:12,border:`1px solid ${T.border}`,background:T.bg,fontSize:14,color:T.text,outline:"none",resize:"vertical",lineHeight:1.7,boxSizing:"border-box",fontFamily:"inherit"}}/>
          </div>

          {/* Emotion / Activity Tabs */}
          <div style={sec}>
            <div style={{display:"flex",gap:0,marginBottom:16}}>
              {["emotion","activity"].map(t=>(
                <button key={t} onClick={()=>setTab(t)} style={{flex:1,padding:"10px 0",border:"none",background:"none",fontSize:14,fontWeight:tab===t?700:500,color:tab===t?T.accent:T.textSub,borderBottom:`2px solid ${tab===t?T.accent:"transparent"}`,cursor:"pointer"}}>{t==="emotion"?"ê°ì •":"í™œë™"}</button>
              ))}
            </div>
            {tab==="emotion" && (
              <>
                <div style={{fontSize:12,color:T.textSub,marginBottom:12}}>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš” (ìµœëŒ€ 5ê°œ)</div>
                <div style={{display:"flex",flexWrap:"wrap",gap:8,marginBottom:16}}>
                  {EMO_KEYS.map(k=>{const e=EMOTIONS[k];const sel=selEmotions.find(x=>x.key===k);return(
                    <button key={k} onClick={()=>toggleEmo(k)} style={{padding:"8px 14px",borderRadius:20,border:`1.5px solid ${sel?e.color:T.border}`,background:sel?e.color+"22":T.bg,fontSize:13,cursor:"pointer",color:sel?T.text:T.textSub,fontWeight:sel?600:400,transition:"all 0.15s"}}>{e.emoji} {e.label}</button>
                  );})}
                </div>
                {selEmotions.length>0 && (
                  <div style={{display:"flex",flexDirection:"column",gap:10}}>
                    {selEmotions.map(e=>(
                      <div key={e.key} style={{display:"flex",alignItems:"center",gap:12}}>
                        <span style={{fontSize:13,fontWeight:600,minWidth:60,color:T.text}}>{EMOTIONS[e.key].emoji} {EMOTIONS[e.key].label}</span>
                        <div style={{flex:1,display:"flex",gap:6}}>
                          {INTENSITY.map((label,i)=>(
                            <button key={i} onClick={()=>setIntensity(e.key,i+1)} style={{flex:1,padding:"6px 0",borderRadius:8,border:`1px solid ${e.intensity===i+1?EMOTIONS[e.key].color:T.border}`,background:e.intensity===i+1?EMOTIONS[e.key].color+"33":"transparent",fontSize:11,color:e.intensity===i+1?T.text:T.textSub,cursor:"pointer",fontWeight:e.intensity===i+1?600:400}}>{label}</button>
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </>
            )}
            {tab==="activity" && (
              <div style={{display:"flex",flexWrap:"wrap",gap:8}}>
                {ACTIVITIES.map(a=>{const sel=selActivities.includes(a);return(
                  <button key={a} onClick={()=>toggleAct(a)} style={{padding:"8px 14px",borderRadius:20,border:`1.5px solid ${sel?T.accent:T.border}`,background:sel?T.accentBg:T.bg,fontSize:13,cursor:"pointer",color:sel?T.accent:T.textSub,fontWeight:sel?600:400}}>{a}</button>
                );})}
              </div>
            )}
          </div>

          {/* Places */}
          <div style={sec}>
            <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:10}}>ë°©ë¬¸ ì¥ì†Œ</div>
            <div style={{display:"flex",gap:8,marginBottom:10}}>
              <input value={newPlace} onChange={e=>setNewPlace(e.target.value)} onKeyDown={e=>e.key==="Enter"&&addPlace()} placeholder="ì¥ì†Œ ì´ë¦„ ì…ë ¥" style={{flex:1,padding:"10px 14px",borderRadius:10,border:`1px solid ${T.border}`,background:T.bg,fontSize:13,color:T.text,outline:"none"}}/>
              <button onClick={addPlace} style={{padding:"10px 16px",borderRadius:10,border:"none",background:T.accent,color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>ì¶”ê°€</button>
            </div>
            <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
              {places.map((p,i)=>(
                <span key={i} style={{padding:"6px 12px",borderRadius:16,background:T.accentBg,fontSize:12,color:T.accent,fontWeight:500,display:"flex",alignItems:"center",gap:4}}>
                  ğŸ“ {p.name} <button onClick={()=>setPlaces(places.filter((_,j)=>j!==i))} style={{background:"none",border:"none",cursor:"pointer",fontSize:12,color:T.textSub}}>Ã—</button>
                </span>
              ))}
            </div>
          </div>

          {/* Payments */}
          <div style={sec}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
              <div style={{fontSize:14,fontWeight:700,color:T.text}}>ê²°ì œ ë‚´ì—­</div>
              <button onClick={addPayment} style={{background:T.accentBg,border:"none",borderRadius:8,padding:"6px 12px",fontSize:12,color:T.accent,fontWeight:600,cursor:"pointer"}}>+ ì¶”ê°€</button>
            </div>
            {payments.map((p,i)=>(
              <div key={i} style={{display:"flex",gap:8,marginBottom:8,alignItems:"center"}}>
                <input value={p.store} onChange={e=>{const n=[...payments];n[i]={...n[i],store:e.target.value};setPayments(n);}} placeholder="ê°€ê²Œëª…" style={{flex:2,padding:"8px 12px",borderRadius:8,border:`1px solid ${T.border}`,background:T.bg,fontSize:13,outline:"none",color:T.text}}/>
                <input type="number" value={p.amount||""} onChange={e=>{const n=[...payments];n[i]={...n[i],amount:Number(e.target.value)};setPayments(n);}} placeholder="ê¸ˆì•¡" style={{flex:1,padding:"8px 12px",borderRadius:8,border:`1px solid ${T.border}`,background:T.bg,fontSize:13,outline:"none",color:T.text}}/>
                <button onClick={()=>setPayments(payments.filter((_,j)=>j!==i))} style={{background:"none",border:"none",cursor:"pointer",fontSize:16,color:T.textSub}}>Ã—</button>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // â•â•â• Diary Detail â•â•â•
    function DiaryDetail({diary, onBack}) {
      const total = diary.payments?.reduce((s,p)=>s+p.amount,0)||0;
      return (
        <div style={{maxWidth:700,margin:"0 auto"}}>
          <button onClick={onBack} style={{background:"none",border:"none",color:T.textSub,fontSize:14,cursor:"pointer",marginBottom:16}}>â† ëª©ë¡ìœ¼ë¡œ</button>
          <div style={{fontSize:13,color:T.textSub,marginBottom:4}}>{fmtTitle(diary.date)}</div>
          <div style={{fontSize:22,fontWeight:800,color:T.text,marginBottom:20}}>{diary.title}</div>
          {isToday(diary.date)&&<button style={{marginBottom:16,padding:"8px 20px",borderRadius:10,border:`1px solid ${T.accent}`,background:T.accentBg,color:T.accent,fontSize:13,fontWeight:600,cursor:"pointer"}}>ìˆ˜ì •í•˜ê¸°</button>}
          {/* Content */}
          <div style={{background:T.card,borderRadius:16,padding:24,marginBottom:16,boxShadow:T.shadow}}>
            <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:10}}>ì˜¤ëŠ˜ì˜ ì´ì•¼ê¸°</div>
            <div style={{fontSize:14,color:T.text,lineHeight:1.8,whiteSpace:"pre-line"}}>{diary.content}</div>
          </div>
          {/* 2-column grid */}
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16}}>
            {/* Emotions */}
            <div style={{background:T.card,borderRadius:16,padding:20,boxShadow:T.shadow}}>
              <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:12}}>ê°ì •</div>
              {diary.emotions.map(e=>(
                <div key={e.key} style={{marginBottom:10}}>
                  <div style={{fontSize:13,fontWeight:600,marginBottom:4,color:T.text}}>{EMOTIONS[e.key].emoji} {EMOTIONS[e.key].label}</div>
                  <div style={{height:6,borderRadius:3,background:T.border}}>
                    <div style={{height:"100%",borderRadius:3,background:EMOTIONS[e.key].color,width:`${e.intensity*25}%`,transition:"width 0.3s"}}/>
                  </div>
                </div>
              ))}
            </div>
            {/* Activities */}
            <div style={{background:T.card,borderRadius:16,padding:20,boxShadow:T.shadow}}>
              <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:12}}>í™œë™</div>
              <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                {(diary.activities||[]).map(a=>(<span key={a} style={{padding:"6px 12px",borderRadius:14,background:T.accentBg,fontSize:12,color:T.accent,fontWeight:500}}>{a}</span>))}
              </div>
              <div style={{marginTop:16,fontSize:14,fontWeight:700,color:T.text,marginBottom:8}}>ê±¸ìŒ ìˆ˜</div>
              <div style={{fontSize:20,fontWeight:800,color:T.accent}}>{(diary.steps||0).toLocaleString()} <span style={{fontSize:13,fontWeight:500}}>ê±¸ìŒ</span></div>
            </div>
            {/* Places */}
            <div style={{background:T.card,borderRadius:16,padding:20,boxShadow:T.shadow}}>
              <div style={{fontSize:14,fontWeight:700,color:T.text,marginBottom:12}}>ë°©ë¬¸ ì¥ì†Œ</div>
              {(diary.places||[]).map((p,i)=>(
                <div key={i} style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}>
                  <span style={{fontSize:16}}>ğŸ“</span>
                  <span style={{fontSize:13,color:T.text,fontWeight:500}}>{p.name}</span>
                  {p.isFirst&&<span style={{padding:"2px 8px",borderRadius:8,background:"#E8F5E9",color:"#4CAF50",fontSize:10,fontWeight:700}}>ì²« ë°©ë¬¸</span>}
                </div>
              ))}
            </div>
            {/* Payments */}
            <div style={{background:T.card,borderRadius:16,padding:20,boxShadow:T.shadow}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:12}}>
                <span style={{fontSize:14,fontWeight:700,color:T.text}}>ê²°ì œ ë‚´ì—­</span>
                <span style={{fontSize:14,fontWeight:700,color:T.accent}}>{money(total)}</span>
              </div>
              {(diary.payments||[]).map((p,i)=>(
                <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"8px 10px",background:T.bg,borderRadius:8,marginBottom:6,border:`1px solid ${T.border}`}}>
                  <div><div style={{fontSize:13,fontWeight:600,color:T.text}}>{p.store}</div><div style={{fontSize:10,color:T.textSub}}>{p.category}</div></div>
                  <div style={{fontSize:13,fontWeight:700,color:T.text}}>{money(p.amount)}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // â•â•â• Stats Tab â•â•â•
    function StatsTab({diaries}) {
      const allEmo = {}; diaries.forEach(d=>d.emotions.forEach(e=>{allEmo[e.key]=(allEmo[e.key]||0)+e.intensity;}));
      const sorted = Object.entries(allEmo).sort((a,b)=>b[1]-a[1]);
      const maxV = sorted[0]?.[1]||1;
      const kws = ["ì¼ìƒì˜ ê°ì‚¬","ì¹´í˜ íƒë°©","ì§ì¥ ì„±ì·¨","ì¹œêµ¬ì™€ì˜ ì‹œê°„","ì‚°ì±…ê³¼ íœ´ì‹"];
      return (
        <div style={{maxWidth:700,margin:"0 auto"}}>
          <div style={{fontSize:20,fontWeight:800,color:T.text,marginBottom:20}}>í†µê³„</div>
          <div style={{background:T.card,borderRadius:16,padding:24,marginBottom:16,boxShadow:T.shadow}}>
            <div style={{fontSize:15,fontWeight:700,color:T.text,marginBottom:16}}>ê°ì • íŠ¸ë¦¬ë§µ</div>
            <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
              {sorted.map(([k,v])=>{const e=EMOTIONS[k];const pct=Math.max((v/maxV)*100,20);return(
                <div key={k} style={{width:`${pct}%`,minWidth:60,padding:"14px 10px",borderRadius:12,background:e.color+"33",textAlign:"center",flexGrow:v>maxV*0.5?2:1}}>
                  <div style={{fontSize:22}}>{e.emoji}</div>
                  <div style={{fontSize:11,fontWeight:600,color:T.text,marginTop:4}}>{e.label}</div>
                  <div style={{fontSize:10,color:T.textSub}}>{v}ì </div>
                </div>
              );})}
            </div>
          </div>
          <div style={{background:T.card,borderRadius:16,padding:24,marginBottom:16,boxShadow:T.shadow}}>
            <div style={{fontSize:15,fontWeight:700,color:T.text,marginBottom:12}}>AI í‚¤ì›Œë“œ</div>
            <div style={{display:"flex",flexWrap:"wrap",gap:8}}>{kws.map(k=>(<span key={k} style={{padding:"8px 16px",borderRadius:20,background:T.accentBg,fontSize:13,color:T.accent,fontWeight:500}}>#{k}</span>))}</div>
          </div>
          <div style={{background:T.card,borderRadius:16,padding:24,boxShadow:T.shadow}}>
            <div style={{fontSize:15,fontWeight:700,color:T.text,marginBottom:12}}>AIê°€ ë¶„ì„í•œ ë‚˜</div>
            <div style={{fontSize:14,color:T.text,lineHeight:1.7,padding:16,background:T.accentBg,borderRadius:12,fontStyle:"italic"}}>"ì‘ì€ ê²ƒì—ì„œ í–‰ë³µì„ ì°¾ê³ , ì‚¬ëŒë“¤ê³¼ì˜ ë§Œë‚¨ì—ì„œ ì—ë„ˆì§€ë¥¼ ì–»ëŠ” ë”°ëœ»í•œ ì‚¬ëŒì…ë‹ˆë‹¤."</div>
          </div>
        </div>
      );
    }

    // â•â•â• AI Chat Modal â•â•â•
    function AIChatModal({onClose, diaries}) {
      const [msgs, setMsgs] = useState([{role:"ai",text:"ì•ˆë…•í•˜ì„¸ìš”! í•˜ë£¨í•œì¤„ AIì˜ˆìš” â˜•\n\nì¼ê¸°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.\n\nâ€¢ \"ì–´ë””ì— ëˆì„ ë§ì´ ì¼ì–´?\"\nâ€¢ \"ìì£¼ ë°©ë¬¸í•œ ê³³ì€?\"\nâ€¢ \"ë‚´ ê°ì • íë¦„ì€?\""}]);
      const [input, setInput] = useState("");
      const [loading, setLoading] = useState(false);
      const ref = useRef(null);
      useEffect(()=>{ref.current?.scrollTo(0,ref.current.scrollHeight);},[msgs]);
      const analyze = q => {
        const l=q.toLowerCase();
        if(l.includes("ëˆ")||l.includes("ì§€ì¶œ")||l.includes("ì¼")){const tot=diaries.reduce((s,d)=>s+(d.payments?.reduce((a,p)=>a+p.amount,0)||0),0);return `ğŸ’° ì´ ì§€ì¶œ: ${money(tot)}\n\nì™¸ì‹ê³¼ ì¹´í˜ ë°©ë¬¸ ì‹œ ì§€ì¶œì´ í° í¸ì´ì—ìš”.`;}
        if(l.includes("ë°©ë¬¸")||l.includes("ì¥ì†Œ")){const pc={};diaries.forEach(d=>(d.places||[]).forEach(p=>{pc[p.name]=(pc[p.name]||0)+1;}));const s=Object.entries(pc).sort((a,b)=>b[1]-a[1]).slice(0,5);return `ğŸ“ ìì£¼ ë°©ë¬¸í•œ ê³³ TOP 5:\n${s.map(([p,c],i)=>`${i+1}. ${p} (${c}íšŒ)`).join("\n")}`;}
        if(l.includes("ê°ì •")||l.includes("ê¸°ë¶„")){const ec={};diaries.forEach(d=>d.emotions.forEach(e=>{ec[e.key]=(ec[e.key]||0)+1;}));const s=Object.entries(ec).sort((a,b)=>b[1]-a[1]);return `ğŸ­ ê°ì • ë¶„ì„:\n${s.map(([e,c],i)=>`${i+1}. ${EMOTIONS[e]?.emoji} ${EMOTIONS[e]?.label} (${c}íšŒ)`).join("\n")}\n\nì „ë°˜ì ìœ¼ë¡œ ê¸ì •ì ì¸ ê°ì •ì´ ìš°ì„¸í•´ìš”!`;}
        return "ë‹¤ë¥¸ ì§ˆë¬¸ì„ í•´ë³´ì‹œê² ì–´ìš”? ì§€ì¶œ, ì¥ì†Œ, ê°ì • ë¶„ì„ ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤ â˜•";
      };
      const send = () => {if(!input.trim()||loading)return;const q=input;setInput("");setMsgs(p=>[...p,{role:"user",text:q}]);setLoading(true);setTimeout(()=>{setMsgs(p=>[...p,{role:"ai",text:analyze(q)}]);setLoading(false);},1000);};
      return (
        <div style={{position:"fixed",inset:0,background:"rgba(74,55,40,0.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={onClose}>
          <div onClick={e=>e.stopPropagation()} style={{width:400,height:520,background:T.card,borderRadius:20,display:"flex",flexDirection:"column",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"}}>
            <div style={{padding:"16px 20px",borderBottom:`1px solid ${T.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <span style={{fontSize:15,fontWeight:700,color:T.text}}>AI ë¶„ì„ â˜•</span>
              <button onClick={onClose} style={{background:"none",border:"none",fontSize:20,cursor:"pointer",color:T.textSub}}>Ã—</button>
            </div>
            <div ref={ref} style={{flex:1,overflow:"auto",padding:16}}>
              {msgs.map((m,i)=>(<div key={i} style={{display:"flex",justifyContent:m.role==="user"?"flex-end":"flex-start",marginBottom:10}}><div style={{maxWidth:"80%",padding:"10px 14px",borderRadius:14,background:m.role==="user"?T.accent:T.bg,color:m.role==="user"?"#fff":T.text,fontSize:13,lineHeight:1.6,whiteSpace:"pre-line"}}>{m.text}</div></div>))}
              {loading&&<div style={{display:"flex"}}><div style={{background:T.bg,padding:"10px 16px",borderRadius:14,fontSize:13,color:T.textSub}}>ë¶„ì„ ì¤‘... â˜•</div></div>}
            </div>
            <div style={{padding:12,borderTop:`1px solid ${T.border}`,display:"flex",gap:8}}>
              <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==="Enter"&&send()} placeholder="ì§ˆë¬¸í•´ë³´ì„¸ìš”..." style={{flex:1,padding:"10px 16px",borderRadius:20,border:`1px solid ${T.border}`,background:T.bg,fontSize:13,outline:"none",color:T.text}}/>
              <button onClick={send} style={{width:38,height:38,borderRadius:"50%",border:"none",background:input.trim()?T.accent:T.border,color:"#fff",cursor:"pointer",fontSize:15}}>â†‘</button>
            </div>
          </div>
        </div>
      );
    }

    // â•â•â• Main App â•â•â•
    function MainApp() {
      const {user, logout} = useAuth();
      const [diaries, setDiaries] = useState(INIT_DIARIES);
      const [mainTab, setMainTab] = useState("diary");
      const [selected, setSelected] = useState(null);
      const [writing, setWriting] = useState(false);
      const [showFilter, setShowFilter] = useState(false);
      const [showAI, setShowAI] = useState(false);
      const [sd, setSd] = useState("");
      const [ed, setEd] = useState("");
      const [savedToast, setSavedToast] = useState(false);

      const todayWritten = diaries.some(d=>d.date===today());
      const streak = (() => { let s=0; const d=new Date(); for(let i=0;i<365;i++){const ds=new Date(d);ds.setDate(ds.getDate()-i);const key=ds.toISOString().slice(0,10);if(diaries.some(x=>x.date===key))s++;else break;} return s; })();

      const filtered = diaries.filter(d=>{
        if(sd&&d.date<sd) return false;
        if(ed&&d.date>ed) return false;
        return true;
      }).sort((a,b)=>b.date.localeCompare(a.date));

      const handleSaveDiary = (data) => {
        const existing = diaries.find(d=>d.date===today());
        if (existing) {
          setDiaries(diaries.map(d=>d.date===today()?{...d,...data,id:d.id}:d));
        } else {
          setDiaries([{...data,id:Date.now()},...diaries]);
        }
        setWriting(false);
        setSavedToast(true);
        setTimeout(()=>setSavedToast(false),2500);
      };

      const tabs = [
        {id:"diary",label:"ì¼ê¸°",icon:"ğŸ“"},{id:"community",label:"ì»¤ë®¤ë‹ˆí‹°",icon:"ğŸ‘¥"},
        {id:"meetup",label:"ë§Œë‚¨",icon:"ğŸ¤"},{id:"shopping",label:"ì‡¼í•‘",icon:"ğŸ›ï¸"},
        {id:"stats",label:"í†µê³„",icon:"ğŸ“Š"},{id:"mypage",label:"ë§ˆì´í˜ì´ì§€",icon:"ğŸ‘¤"},
      ];

      if (writing) return (
        <div style={{minHeight:"100vh",background:T.bg,fontFamily:"'Noto Sans KR',sans-serif"}}>
          <DiaryWritePage onSave={handleSaveDiary} onCancel={()=>setWriting(false)} editData={todayWritten?diaries.find(d=>d.date===today()):null}/>
        </div>
      );

      return (
        <div style={{display:"flex",minHeight:"100vh",background:T.bg,fontFamily:"'Noto Sans KR',sans-serif"}}>
          {/* Sidebar */}
          <div style={{width:220,background:T.card,borderRight:`1px solid ${T.border}`,display:"flex",flexDirection:"column",flexShrink:0}}>
            <div style={{padding:"28px 20px 20px",borderBottom:`1px solid ${T.border}`}}>
              <div style={{display:"flex",alignItems:"center",gap:10}}>
                <div style={{fontSize:28}}>ğŸ“–</div>
                <div><div style={{fontSize:17,fontWeight:800,color:T.text}}>í•˜ë£¨í•œì¤„</div><div style={{fontSize:10,color:T.textSub}}>ë§¤ì¼ í•œ ì¤„ì˜ ê¸°ë¡</div></div>
              </div>
            </div>
            {/* User Info */}
            <div style={{padding:"16px 20px",borderBottom:`1px solid ${T.border}`,display:"flex",alignItems:"center",gap:10}}>
              <div style={{width:36,height:36,borderRadius:"50%",background:T.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:700,color:T.accent}}>{user?.name?.[0]||"U"}</div>
              <div><div style={{fontSize:13,fontWeight:600,color:T.text}}>{user?.name}</div><div style={{fontSize:10,color:T.textSub}}>{user?.email}</div></div>
            </div>
            <div style={{flex:1,padding:"12px 10px"}}>
              {tabs.map(t=>(
                <button key={t.id} onClick={()=>{setMainTab(t.id);setSelected(null);}} style={{width:"100%",display:"flex",alignItems:"center",gap:10,padding:"11px 14px",borderRadius:12,border:"none",background:mainTab===t.id?T.accentBg:"transparent",color:mainTab===t.id?T.accent:T.textSub,fontSize:14,fontWeight:mainTab===t.id?700:500,cursor:"pointer",marginBottom:2,transition:"all 0.15s",textAlign:"left"}}>
                  <span style={{fontSize:18}}>{t.icon}</span>{t.label}
                </button>
              ))}
            </div>
            <div style={{padding:"12px 16px",borderTop:`1px solid ${T.border}`}}>
              <button onClick={logout} style={{width:"100%",padding:"10px 0",borderRadius:10,border:`1px solid ${T.border}`,background:"transparent",color:T.textSub,fontSize:13,cursor:"pointer"}}>ë¡œê·¸ì•„ì›ƒ</button>
            </div>
          </div>

          {/* Content */}
          <div style={{flex:1,overflow:"auto",padding:"32px 40px"}}>
            {mainTab==="diary" && !selected && (
              <>
                {/* Streak */}
                {streak>0 && (
                  <div style={{background:`linear-gradient(135deg, ${T.accent}, #9B7B5A)`,borderRadius:16,padding:"16px 24px",marginBottom:20,display:"flex",alignItems:"center",justifyContent:"space-between",color:"#fff"}}>
                    <div><div style={{fontSize:15,fontWeight:700}}>ğŸ”¥ {streak}ì¼ ì—°ì† ê¸°ë¡ ì¤‘!</div><div style={{fontSize:12,opacity:0.85,marginTop:2}}>ê¾¸ì¤€íˆ ê¸°ë¡í•˜ëŠ” ë‹¹ì‹ , ë©‹ì ¸ìš”</div></div>
                    <div style={{fontSize:32,fontWeight:800}}>{streak}</div>
                  </div>
                )}
                {/* Actions */}
                <div style={{display:"flex",gap:10,marginBottom:20}}>
                  <button onClick={()=>setShowFilter(true)} style={{padding:"10px 20px",borderRadius:12,border:`1px solid ${T.border}`,background:T.card,color:T.text,fontSize:13,fontWeight:600,cursor:"pointer",boxShadow:T.shadow}}>ğŸ“… í•„í„°</button>
                  <button onClick={()=>setShowAI(true)} style={{padding:"10px 20px",borderRadius:12,border:`1px solid ${T.border}`,background:T.card,color:T.text,fontSize:13,fontWeight:600,cursor:"pointer",boxShadow:T.shadow}}>ğŸ¤– AI ë¶„ì„</button>
                  <div style={{flex:1}}/>
                  <button onClick={()=>{if(todayWritten){if(window.confirm("ì˜¤ëŠ˜ ì¼ê¸°ë¥¼ ì´ë¯¸ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\nìˆ˜ì •í•˜ì‹œê² ì–´ìš”?"))setWriting(true);}else setWriting(true);}} style={{padding:"10px 24px",borderRadius:12,border:"none",background:todayWritten?T.border:T.gradient,color:todayWritten?T.textSub:"#fff",fontSize:13,fontWeight:700,cursor:"pointer",boxShadow:todayWritten?"none":`0 4px 16px ${T.accent}44`}}>
                    âœï¸ {todayWritten?"ì˜¤ëŠ˜ ì¼ê¸° ìˆ˜ì •":"ì¼ê¸°ì“°ê¸°"}
                  </button>
                </div>
                {/* Diary List */}
                <div style={{display:"flex",flexDirection:"column",gap:12}}>
                  {filtered.map(d=>{const total=(d.payments||[]).reduce((s,p)=>s+p.amount,0);return(
                    <div key={d.id} onClick={()=>setSelected(d)} style={{background:T.card,borderRadius:16,padding:"20px 24px",cursor:"pointer",boxShadow:T.shadow,transition:"all 0.2s",border:"1px solid transparent"}} onMouseEnter={e=>{e.currentTarget.style.boxShadow=T.shadowHover;e.currentTarget.style.border=`1px solid ${T.accentLight}`;}} onMouseLeave={e=>{e.currentTarget.style.boxShadow=T.shadow;e.currentTarget.style.border="1px solid transparent";}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                        <div>
                          <div style={{fontSize:12,color:T.textSub,marginBottom:4}}>{fmt(d.date)} {isToday(d.date)&&<span style={{background:T.accent,color:"#fff",padding:"1px 8px",borderRadius:6,fontSize:10,fontWeight:700,marginLeft:6}}>TODAY</span>}</div>
                          <div style={{fontSize:16,fontWeight:700,color:T.text,marginBottom:10}}>{d.title}</div>
                        </div>
                        {total>0&&<div style={{fontSize:13,fontWeight:600,color:T.accent}}>{money(total)}</div>}
                      </div>
                      <div style={{display:"flex",flexWrap:"wrap",gap:6,marginBottom:8}}>
                        {d.emotions.map(e=>(<span key={e.key} style={{padding:"4px 10px",borderRadius:12,background:EMOTIONS[e.key].color+"22",fontSize:12,color:T.text,fontWeight:500}}>{EMOTIONS[e.key].emoji} {EMOTIONS[e.key].label}</span>))}
                      </div>
                      <div style={{display:"flex",flexWrap:"wrap",gap:6}}>
                        {(d.places||[]).map((p,i)=>(<span key={i} style={{fontSize:12,color:T.textSub}}>ğŸ“ {p.name}{p.isFirst&&<span style={{color:"#4CAF50",fontSize:10,fontWeight:700,marginLeft:4}}>NEW</span>}</span>))}
                      </div>
                    </div>
                  );})}
                </div>
              </>
            )}
            {mainTab==="diary" && selected && <DiaryDetail diary={selected} onBack={()=>setSelected(null)}/>}
            {mainTab==="stats" && <StatsTab diaries={diaries}/>}
            {mainTab==="mypage" && (
              <div style={{maxWidth:500}}>
                <div style={{fontSize:20,fontWeight:800,color:T.text,marginBottom:24}}>ë§ˆì´í˜ì´ì§€</div>
                <div style={{background:T.card,borderRadius:16,padding:24,boxShadow:T.shadow,marginBottom:16}}>
                  <div style={{display:"flex",alignItems:"center",gap:16,marginBottom:20}}>
                    <div style={{width:64,height:64,borderRadius:"50%",background:T.accentBg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28,fontWeight:700,color:T.accent}}>{user?.name?.[0]}</div>
                    <div><div style={{fontSize:18,fontWeight:700,color:T.text}}>{user?.name}</div><div style={{fontSize:13,color:T.textSub}}>{user?.email}</div><div style={{fontSize:12,color:T.textMuted,marginTop:2}}>ê°€ì…ì¼: {user?.joinDate}</div></div>
                  </div>
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12}}>
                    <div style={{textAlign:"center",padding:16,background:T.bg,borderRadius:12}}><div style={{fontSize:22,fontWeight:800,color:T.accent}}>{diaries.length}</div><div style={{fontSize:11,color:T.textSub}}>ì´ ì¼ê¸°</div></div>
                    <div style={{textAlign:"center",padding:16,background:T.bg,borderRadius:12}}><div style={{fontSize:22,fontWeight:800,color:T.accent}}>{streak}</div><div style={{fontSize:11,color:T.textSub}}>ì—°ì† ê¸°ë¡</div></div>
                    <div style={{textAlign:"center",padding:16,background:T.bg,borderRadius:12}}><div style={{fontSize:22,fontWeight:800,color:T.accent}}>{money(diaries.reduce((s,d)=>s+(d.payments?.reduce((a,p)=>a+p.amount,0)||0),0))}</div><div style={{fontSize:11,color:T.textSub}}>ì´ ì§€ì¶œ</div></div>
                  </div>
                </div>
                <button onClick={logout} style={{width:"100%",padding:14,borderRadius:12,border:`1px solid ${T.danger}`,background:"transparent",color:T.danger,fontSize:14,fontWeight:600,cursor:"pointer"}}>ë¡œê·¸ì•„ì›ƒ</button>
              </div>
            )}
            {!["diary","stats","mypage"].includes(mainTab) && (
              <div style={{textAlign:"center",padding:80,color:T.textSub}}>
                <div style={{fontSize:48,marginBottom:14}}>{tabs.find(t=>t.id===mainTab)?.icon}</div>
                <div style={{fontSize:18,fontWeight:700,color:T.text,marginBottom:6}}>{tabs.find(t=>t.id===mainTab)?.label}</div>
                <div style={{fontSize:14}}>ê³§ ì°¾ì•„ì˜¬ ì˜ˆì •ì´ì—ìš”!</div>
              </div>
            )}
          </div>

          {/* Filter Modal */}
          {showFilter && (
            <div style={{position:"fixed",inset:0,background:"rgba(74,55,40,0.5)",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center"}} onClick={()=>setShowFilter(false)}>
              <div onClick={e=>e.stopPropagation()} style={{width:380,background:T.card,borderRadius:20,padding:"32px 28px",boxShadow:"0 20px 60px rgba(0,0,0,0.2)"}}>
                <div style={{fontSize:18,fontWeight:700,color:T.text,marginBottom:20}}>ğŸ“… ë‚ ì§œ í•„í„°</div>
                <div style={{marginBottom:14}}><label style={{fontSize:12,color:T.textSub,fontWeight:600}}>ì‹œì‘ ë‚ ì§œ</label><input type="date" value={sd} onChange={e=>setSd(e.target.value)} style={{width:"100%",padding:"12px 14px",borderRadius:12,border:`1px solid ${T.border}`,marginTop:6,fontSize:14,background:T.bg,color:T.text,boxSizing:"border-box"}}/></div>
                <div style={{marginBottom:24}}><label style={{fontSize:12,color:T.textSub,fontWeight:600}}>ë ë‚ ì§œ</label><input type="date" value={ed} onChange={e=>setEd(e.target.value)} style={{width:"100%",padding:"12px 14px",borderRadius:12,border:`1px solid ${T.border}`,marginTop:6,fontSize:14,background:T.bg,color:T.text,boxSizing:"border-box"}}/></div>
                <div style={{display:"flex",gap:12}}>
                  <button onClick={()=>{setSd("");setEd("");setShowFilter(false);}} style={{flex:1,padding:14,borderRadius:12,border:`1px solid ${T.border}`,background:T.card,fontSize:14,fontWeight:600,color:T.textSub,cursor:"pointer"}}>ì´ˆê¸°í™”</button>
                  <button onClick={()=>setShowFilter(false)} style={{flex:1,padding:14,borderRadius:12,border:"none",background:T.accent,color:"#fff",fontSize:14,fontWeight:600,cursor:"pointer"}}>ì ìš©</button>
                </div>
              </div>
            </div>
          )}

          {showAI && <AIChatModal onClose={()=>setShowAI(false)} diaries={diaries}/>}

          {savedToast && (
            <div style={{position:"fixed",bottom:32,left:"50%",transform:"translateX(-50%)",background:T.accent,color:"#fff",padding:"14px 32px",borderRadius:16,fontSize:14,fontWeight:600,boxShadow:`0 8px 32px ${T.accent}66`,zIndex:2000}}>
              âœ¨ ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
            </div>
          )}
        </div>
      );
    }

    // â•â•â• Root â•â•â•
    function App() {
      return <AuthProvider><AuthRouter/></AuthProvider>;
    }

    function AuthRouter() {
      const {user, loading} = useAuth();
      if (loading) return (
        <div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"'Noto Sans KR',sans-serif"}}>
          <div style={{textAlign:"center"}}>
            <div style={{fontSize:56,marginBottom:16,animation:"pulse 1.5s infinite"}}>ğŸ“–</div>
            <div style={{fontSize:15,color:T.textSub,fontWeight:500}}>ë¡œë”© ì¤‘...</div>
          </div>
        </div>
      );
      return user ? <MainApp/> : <LoginPage/>;
    }

    // â•â•â• Render â•â•â•
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App/>);
  </script>
</body>
</html>
