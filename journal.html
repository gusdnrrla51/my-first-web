<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>하루한줄 — 일기 작성</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #F5F0E8;
      color: #3D3529;
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const emotions = [
      { emoji: "\u{1F60A}", label: "행복", color: "#D4A017" },
      { emoji: "\u{1F60C}", label: "평온", color: "#7BA05B" },
      { emoji: "\u{1F622}", label: "슬픔", color: "#6B8CAE" },
      { emoji: "\u{1F624}", label: "화남", color: "#C4605A" },
      { emoji: "\u{1F630}", label: "불안", color: "#9B7DB8" },
      { emoji: "\u{1F634}", label: "피곤", color: "#8E8477" },
      { emoji: "\u{1F970}", label: "설렘", color: "#C97B84" },
      { emoji: "\u{1F610}", label: "무덤덤", color: "#9C9488" },
      { emoji: "\u{1F914}", label: "고민", color: "#C4884D" },
      { emoji: "\u{1F60E}", label: "뿌듯", color: "#5B9EAD" },
    ];
    const actList = [
      { emoji: "\u{1F4BC}", label: "업무" }, { emoji: "\u{1F4DA}", label: "공부" }, { emoji: "\u{1F3CB}\uFE0F", label: "운동" },
      { emoji: "\u{1F37D}\uFE0F", label: "식사" }, { emoji: "\u2615", label: "카페" }, { emoji: "\u{1F6D2}", label: "쇼핑" },
      { emoji: "\u{1F3AC}", label: "영화" }, { emoji: "\u{1F465}", label: "모임" }, { emoji: "\u{1F3E0}", label: "집" }, { emoji: "\u{1F6B6}", label: "산책" },
    ];
    const intensityLabels = ["약함", "보통", "강함", "매우 강함"];
    const T = {
      bg: "#F5F0E8", card: "#FFFDF7", cardBorder: "#E8E0D0", input: "#F0EBE1",
      inputBorder: "#DDD5C5", text: "#3D3529", textSub: "#7A7060", textMuted: "#A89F90",
      accent: "#B8956A", accentLight: "#D4BA94", tag: "#EDE7DA", tagBorder: "#D9D0C0",
      divider: "#E5DDD0",
    };
    const STEPS = [
      { id:"welcome", target:null, title:"\u{1F4D6} 일기장에 오신 것을 환영합니다!", desc:"하루를 기록하는 나만의 공간이에요.\n각 섹션을 하나씩 안내해드릴게요.", position:"center" },
      { id:"title", target:"section-title", title:"\u270F\uFE0F 제목 입력", desc:"오늘의 일기 제목을 적어보세요.\n날짜가 기본으로 들어가 있어요.", position:"bottom" },
      { id:"location", target:"section-location", title:"\u{1F4CD} 방문 위치 기록", desc:"네이버 지도 또는 구글 맵 중 선택하고,\n장소명과 방문 시간을 입력하세요.\n여러 장소를 추가할 수 있어요!", position:"bottom" },
      { id:"location-try", target:"section-location", title:"\u{1F4CD} 직접 해보세요!", desc:"'+ 장소 추가' 버튼을 눌러\n새 장소를 추가해보세요.", position:"bottom", action:"add-location" },
      { id:"payment", target:"section-payment", title:"\u{1F4B3} 카드 결제 내역", desc:"결제 캡처 이미지를 첨부하면\nAI가 자동으로 항목을 인식해요.", position:"bottom" },
      { id:"payment-try", target:"section-payment", title:"\u{1F4B3} AI 인식 체험하기", desc:"'캡처 첨부' 버튼을 누르고\n업로드 영역을 클릭해보세요.", position:"bottom", action:"try-payment" },
      { id:"emotion", target:"section-emotion-tab", title:"\u{1FAE7} 감정 일기", desc:"오늘 느낀 감정을 선택하고\n강도를 설정할 수 있어요.\n복수 선택도 가능합니다!", position:"bottom" },
      { id:"emotion-try", target:"section-emotion-tab", title:"\u{1FAE7} 감정을 선택해보세요!", desc:"감정 버튼을 눌러보고\n강도도 조절해보세요.", position:"bottom", action:"try-emotion" },
      { id:"activity", target:"section-activity-tab", title:"\u{1F3C3} 활동 일기", desc:"오늘 한 활동 태그를 선택하고\n자유롭게 기록해보세요.", position:"top", action:"switch-activity" },
      { id:"complete", target:null, title:"\u{1F389} 튜토리얼 완료!", desc:"이제 자유롭게 일기를 작성해보세요.\n매일 기록하면 소중한 추억이 됩니다.", position:"center" },
    ];
    const mapIcons = {
      naver: <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect width="18" height="18" rx="4" fill="#03C75A"/><path d="M10.2 9.5L7.6 5.5H5.5V12.5H7.8V8.5L10.4 12.5H12.5V5.5H10.2V9.5Z" fill="white"/></svg>,
      google: <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect width="18" height="18" rx="4" fill="#4285F4"/><circle cx="9" cy="7.5" r="2.5" stroke="white" strokeWidth="1.5" fill="none"/><path d="M9 10C9 10 5 12 5 14H13C13 12 9 10 9 10Z" fill="white" opacity="0.7"/></svg>,
    };

    function LocationItem({ loc, onRemove, onUpdate }) {
      return (
        <div className="loc-card">
          <div className="loc-row1">
            <div className="loc-maps">
              <button onClick={()=>onUpdate({...loc,mapType:"naver"})} className={"map-btn " + (loc.mapType==="naver"?"map-naver":"")}>{mapIcons.naver}</button>
              <button onClick={()=>onUpdate({...loc,mapType:"google"})} className={"map-btn " + (loc.mapType==="google"?"map-google":"")}>{mapIcons.google}</button>
            </div>
            <div className="loc-name-wrap">
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke={T.textMuted} strokeWidth="2"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
              <input value={loc.name} onChange={e=>onUpdate({...loc,name:e.target.value})} placeholder="장소명 입력" className="loc-name-input"/>
            </div>
            <button onClick={onRemove} className="loc-del">&times;</button>
          </div>
          <div className="loc-row2">
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke={T.textMuted} strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
            <input type="time" value={loc.startTime} onChange={e=>onUpdate({...loc,startTime:e.target.value})} className="time-input"/>
            <span className="time-sep">~</span>
            <input type="time" value={loc.endTime} onChange={e=>onUpdate({...loc,endTime:e.target.value})} className="time-input"/>
          </div>
        </div>
      );
    }

    function PaymentItem({ item, onRemove }) {
      return (
        <div className="pay-card">
          <span style={{ fontSize:15, flexShrink:0 }}>{"\u{1F4B3}"}</span>
          <div className="pay-info">
            <span className="pay-store">{item.store}</span>
            <div className="pay-meta">
              <span className="pay-cat">{item.category}</span>
              <span className="pay-amount">{item.amount}</span>
            </div>
          </div>
          <button onClick={onRemove} className="loc-del">&times;</button>
        </div>
      );
    }

    function Tooltip({ step, stepIdx, total, targetRef, onNext, onPrev, onSkip, containerRef }) {
      const [pos, setPos] = useState({});
      const tipRef = useRef(null);
      useEffect(() => {
        if (step.position==="center") { setPos({ top:"50%", left:"50%", transform:"translate(-50%,-50%)", position:"fixed" }); return; }
        if (!targetRef?.current||!tipRef.current||!containerRef?.current) return;
        const t=targetRef.current.getBoundingClientRect(), c=containerRef.current.getBoundingClientRect();
        const w=Math.min(320, c.width-32);
        let top,left;
        if (step.position==="bottom") { top=t.bottom-c.top+12; left=Math.max(16,Math.min(t.left-c.left+t.width/2-w/2,c.width-w-16)); }
        else { top=t.top-c.top-(tipRef.current?.offsetHeight||180)-12; left=Math.max(16,Math.min(t.left-c.left+t.width/2-w/2,c.width-w-16)); }
        setPos({ top, left, position:"absolute", transform:"none" });
      }, [step, targetRef, containerRef]);
      const pct=((stepIdx+1)/total)*100;
      return (
        <div ref={tipRef} className="tooltip-box" style={pos}>
          <div className="tooltip-progress-wrap">
            <div className="tooltip-progress-bar"><div className="tooltip-progress-fill" style={{ width:pct+"%" }}/></div>
            <span className="tooltip-step-count">{stepIdx+1}/{total}</span>
          </div>
          <div className="tooltip-title">{step.title}</div>
          <div className="tooltip-desc">{step.desc}</div>
          {step.action && <div className="tooltip-action"><span>{"\u{1F446}"}</span><span>아래 영역에서 직접 조작해보세요!</span></div>}
          <div className="tooltip-btns">
            <button onClick={onSkip} className="tooltip-skip">건너뛰기</button>
            <div style={{ display:"flex", gap:8 }}>
              {stepIdx>0 && <button onClick={onPrev} className="tooltip-prev">{"\u2190"} 이전</button>}
              <button onClick={onNext} className="tooltip-next">{stepIdx===total-1?"시작하기 \u{1F680}":"다음 \u2192"}</button>
            </div>
          </div>
        </div>
      );
    }

    function DiaryApp() {
      const today = new Date();
      const dateStr = today.getFullYear() + "년 " + (today.getMonth()+1) + "월 " + today.getDate() + "일";
      const dayNames = ["일","월","화","수","목","금","토"];
      const dayStr = dayNames[today.getDay()]+"요일";

      const [step, setStep] = useState(0);
      const [on, setOn] = useState(true);
      const [title, setTitle] = useState("");
      const [locs, setLocs] = useState([
        { id:1, mapType:"naver", name:"스타벅스 강남역점", startTime:"10:00", endTime:"11:30" },
        { id:2, mapType:"google", name:"코엑스몰", startTime:"13:00", endTime:"15:00" },
      ]);
      const [nid, setNid] = useState(3);
      const [pays, setPays] = useState([
        { id:1, store:"스타벅스 강남역점", amount:"6,500원", category:"카페" },
        { id:2, store:"버거킹 코엑스점", amount:"12,800원", category:"식사" },
      ]);
      const [proc, setProc] = useState(false);
      const [upload, setUpload] = useState(false);
      const [selEmo, setSelEmo] = useState([0,6]);
      const [emoInt, setEmoInt] = useState(2);
      const [emoDiary, setEmoDiary] = useState("");
      const [actDiary, setActDiary] = useState("");
      const [tab, setTab] = useState("emotion");
      const [selAct, setSelAct] = useState([0,1,2]);

      const cRef = useRef(null);
      const titleRef = useRef(null);
      const locRef = useRef(null);
      const payRef = useRef(null);
      const emoRef = useRef(null);
      const actRef = useRef(null);
      const rm = { "section-title":titleRef, "section-location":locRef, "section-payment":payRef, "section-emotion-tab":emoRef, "section-activity-tab":actRef };

      const cs = STEPS[step];
      const tr = cs?.target ? rm[cs.target] : null;

      useEffect(() => {
        if (!on||!cs?.target) return;
        var ref = rm[cs.target];
        if (ref && ref.current) ref.current.scrollIntoView({ behavior:"smooth", block:"center" });
      }, [step, on]);
      useEffect(() => { if (on && cs?.action==="switch-activity") setTab("activity"); }, [step, on]);

      const next = () => { if (step>=STEPS.length-1){setOn(false);return;} setStep(function(s){return s+1;}); };
      const prev = () => setStep(function(s){return Math.max(0,s-1);});
      const skip = () => setOn(false);
      const addLoc = () => { setLocs(function(p){return [...p,{id:nid,mapType:"naver",name:"",startTime:"",endTime:""}];}); setNid(function(n){return n+1;}); };
      const togEmo = function(i) { setSelEmo(function(p){return p.includes(i)?p.filter(function(x){return x!==i;}):[...p,i];}); };
      const togAct = function(i) { setSelAct(function(p){return p.includes(i)?p.filter(function(x){return x!==i;}):[...p,i];}); };
      const doAI = () => { setProc(true); setUpload(false); setTimeout(function(){setPays(function(p){return [...p,{id:Date.now(),store:"올리브영 삼성점",amount:"23,400원",category:"쇼핑"}];});setProc(false);},2000); };
      const total = pays.reduce(function(s,p){return s+parseInt(p.amount.replace(/[^0-9]/g,""));},0);

      const isHL = function(id) { return on && cs?.target===id; };
      const hl = function(id) { return { position:"relative", zIndex:isHL(id)?100:"auto", boxShadow:isHL(id)?("0 0 0 3px " + T.accent + "66, 0 4px 20px rgba(0,0,0,0.1)"):"none", borderRadius:12, transition:"box-shadow 0.3s ease" }; };

      return (
        <div ref={cRef} className="diary-root">
          <style dangerouslySetInnerHTML={{__html: "\n            *, *::before, *::after { box-sizing:border-box; -webkit-text-size-adjust:100%; }\n            .diary-root { min-height:100vh; background:" + T.bg + "; color:" + T.text + "; font-family:'Noto Sans KR',-apple-system,BlinkMacSystemFont,'Segoe UI','Helvetica Neue',sans-serif; position:relative; font-size:14px; line-height:1.5; -webkit-font-smoothing:antialiased; }\n            .diary-inner { max-width:780px; margin:0 auto; padding:24px 16px 80px; position:relative; }\n            @media(min-width:500px){ .diary-inner { padding:32px 24px 80px; } }\n\n            .breadcrumb { display:flex; align-items:center; gap:6px; margin-bottom:10px; color:" + T.textMuted + "; font-size:12px; }\n            .diary-title-input { width:100%; background:transparent; border:none; color:" + T.text + "; font-size:24px; font-weight:700; outline:none; padding:0; }\n            @media(min-width:500px){ .diary-title-input { font-size:32px; } }\n            .diary-date { font-size:12px; color:" + T.textMuted + "; margin-top:6px; }\n\n            .card { background:" + T.card + "; border-radius:12px; border:1px solid " + T.cardBorder + "; margin-bottom:20px; overflow:visible; box-shadow:0 1px 4px rgba(0,0,0,0.04); }\n            .card-section { padding:14px 14px; }\n            @media(min-width:500px){ .card-section { padding:16px 20px; } }\n            .card-divider { border-bottom:1px solid " + T.divider + "; }\n\n            .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; flex-wrap:wrap; gap:8px; }\n            .section-label { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }\n            .section-label-text { font-size:13px; font-weight:600; color:" + T.text + "; }\n            @media(min-width:500px){ .section-label-text { font-size:14px; } }\n            .badge { font-size:11px; color:" + T.textMuted + "; background:" + T.tag + "; padding:2px 7px; border-radius:10px; }\n            .total-badge { font-size:11px; color:" + T.accent + "; font-weight:600; }\n            .add-btn { background:" + T.tag + "; border:1px solid " + T.tagBorder + "; border-radius:6px; color:" + T.textSub + "; font-size:12px; padding:4px 10px; cursor:pointer; display:flex; align-items:center; gap:3px; white-space:nowrap; flex-shrink:0; }\n\n            .loc-card { background:" + T.input + "; border-radius:8px; margin-bottom:6px; border:1px solid " + T.inputBorder + "; padding:10px; }\n            .loc-row1 { display:flex; align-items:center; gap:6px; }\n            .loc-maps { display:flex; gap:3px; flex-shrink:0; }\n            .map-btn { background:" + T.card + "; border:1.5px solid " + T.tagBorder + "; border-radius:5px; padding:2px 5px; cursor:pointer; display:flex; align-items:center; }\n            .map-naver { background:#E8F5ED; border-color:#03C75A; }\n            .map-google { background:#E8EFF8; border-color:#4285F4; }\n            .loc-name-wrap { flex:1; display:flex; align-items:center; gap:4px; min-width:0; }\n            .loc-name-input { flex:1; background:transparent; border:none; color:" + T.text + "; font-size:13px; outline:none; min-width:0; }\n            .loc-del { background:none; border:none; color:" + T.textMuted + "; cursor:pointer; font-size:18px; padding:0 2px; line-height:1; flex-shrink:0; }\n\n            .loc-row2 { display:flex; align-items:center; gap:6px; margin-top:8px; padding-top:8px; border-top:1px solid " + T.inputBorder + "; }\n            .time-input { background:" + T.card + "; border:1px solid " + T.inputBorder + "; border-radius:6px; padding:4px 8px; color:" + T.textSub + "; font-size:14px; outline:none; width:auto; min-width:110px; flex:1; max-width:140px; -webkit-appearance:none; }\n            .time-sep { color:" + T.textMuted + "; font-size:13px; flex-shrink:0; }\n\n            .pay-card { display:flex; align-items:center; gap:8px; padding:10px; background:" + T.input + "; border-radius:8px; margin-bottom:6px; border:1px solid " + T.inputBorder + "; }\n            .pay-info { flex:1; min-width:0; }\n            .pay-store { color:" + T.text + "; font-size:13px; display:block; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }\n            .pay-meta { display:flex; align-items:center; gap:8px; margin-top:3px; }\n            .pay-cat { color:" + T.textMuted + "; font-size:11px; background:" + T.tag + "; padding:1px 6px; border-radius:4px; }\n            .pay-amount { color:" + T.accent + "; font-size:13px; font-weight:600; }\n\n            .upload-area { border:2px dashed " + T.tagBorder + "; border-radius:10px; padding:24px 16px; text-align:center; margin-bottom:10px; cursor:pointer; background:" + T.input + "; }\n            .upload-area:hover { border-color:" + T.accent + "; }\n\n            .ai-bar { display:flex; align-items:center; gap:8px; padding:10px 14px; background:#F0EAD6; border-radius:8px; margin-bottom:10px; border:1px solid " + T.accentLight + "; }\n            .spinner { width:18px; height:18px; border:2px solid " + T.accent + "; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; flex-shrink:0; }\n\n            .tabs { display:flex; gap:2px; margin-bottom:0; }\n            .tab-btn { background:transparent; border:1px solid transparent; border-bottom:1px solid " + T.cardBorder + "; border-radius:10px 10px 0 0; padding:9px 14px; color:" + T.textMuted + "; font-size:13px; font-weight:400; cursor:pointer; display:flex; align-items:center; gap:5px; position:relative; bottom:-1px; z-index:0; }\n            .tab-btn.active { background:" + T.card + "; border:1px solid " + T.cardBorder + "; border-bottom:1px solid " + T.card + "; color:" + T.text + "; font-weight:600; z-index:1; }\n            .tab-fill { flex:1; border-bottom:1px solid " + T.cardBorder + "; }\n\n            .tab-content { background:" + T.card + "; border-radius:0 12px 12px 12px; border:1px solid " + T.cardBorder + "; border-top:none; overflow:visible; box-shadow:0 1px 4px rgba(0,0,0,0.04); }\n            .tab-inner { padding:16px 14px; }\n            @media(min-width:500px){ .tab-inner { padding:20px 24px; } }\n\n            .emo-grid { display:flex; flex-wrap:wrap; gap:6px; }\n            .emo-btn { border-radius:10px; padding:7px 11px; cursor:pointer; display:flex; align-items:center; gap:5px; transition:all 0.15s; font-size:0; }\n            .emo-emoji { font-size:17px; }\n            .emo-label { font-size:12px; }\n\n            .int-bar { display:flex; gap:3px; }\n            .int-btn { flex:1; height:32px; border-radius:6px; border:none; cursor:pointer; font-size:11px; transition:all 0.15s; }\n\n            .tag-grid { display:flex; flex-wrap:wrap; gap:5px; margin-bottom:14px; }\n            .tag-btn { border-radius:8px; padding:5px 10px; cursor:pointer; display:flex; align-items:center; gap:4px; }\n            .tag-emoji { font-size:14px; }\n            .tag-label { font-size:12px; }\n\n            .diary-textarea { width:100%; min-height:180px; background:" + T.input + "; border:1px solid " + T.inputBorder + "; border-radius:10px; color:" + T.text + "; font-size:14px; line-height:1.8; padding:14px; outline:none; resize:vertical; font-family:inherit; }\n            @media(min-width:500px){ .diary-textarea { font-size:15px; padding:16px; min-height:200px; } }\n\n            .footer { margin-top:14px; display:flex; justify-content:space-between; align-items:center; color:" + T.textMuted + "; font-size:11px; padding:0 4px; flex-wrap:wrap; gap:4px; }\n\n            .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.25); z-index:50; pointer-events:none; }\n            .overlay-center { position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:50; }\n\n            .tooltip-box { z-index:1000; width:min(320px, calc(100vw - 40px)); background:" + T.card + "; border-radius:14px; padding:20px; border:1px solid " + T.cardBorder + "; box-shadow:0 12px 40px rgba(0,0,0,0.15); }\n            .tooltip-progress-wrap { display:flex; align-items:center; gap:8px; margin-bottom:14px; }\n            .tooltip-progress-bar { flex:1; height:4px; background:" + T.tag + "; border-radius:2px; overflow:hidden; }\n            .tooltip-progress-fill { height:100%; background:linear-gradient(90deg," + T.accent + "," + T.accentLight + "); border-radius:2px; transition:width 0.4s ease; }\n            .tooltip-step-count { font-size:11px; color:" + T.textMuted + "; white-space:nowrap; }\n            .tooltip-title { font-size:16px; font-weight:700; color:" + T.text + "; margin-bottom:6px; }\n            .tooltip-desc { font-size:13px; color:" + T.textSub + "; line-height:1.7; white-space:pre-line; margin-bottom:16px; }\n            .tooltip-action { background:" + T.accent + "15; border:1px dashed " + T.accent + "; border-radius:8px; padding:8px 12px; margin-bottom:14px; display:flex; align-items:center; gap:6px; font-size:12px; color:" + T.accent + "; font-weight:500; }\n            .tooltip-btns { display:flex; justify-content:space-between; align-items:center; }\n            .tooltip-skip { background:none; border:none; color:" + T.textMuted + "; font-size:12px; cursor:pointer; padding:6px 0; }\n            .tooltip-prev { background:" + T.tag + "; border:1px solid " + T.tagBorder + "; border-radius:8px; padding:7px 14px; color:" + T.textSub + "; font-size:12px; cursor:pointer; font-weight:500; }\n            .tooltip-next { background:linear-gradient(135deg," + T.accent + "," + T.accentLight + "); border:none; border-radius:8px; padding:7px 16px; color:#fff; font-size:12px; cursor:pointer; font-weight:600; box-shadow:0 2px 8px " + T.accent + "44; }\n\n            .restart-btn { position:fixed; bottom:20px; right:16px; z-index:200; background:linear-gradient(135deg," + T.accent + "," + T.accentLight + "); border:none; border-radius:50px; padding:10px 16px; color:#fff; font-size:13px; font-weight:600; cursor:pointer; box-shadow:0 4px 16px " + T.accent + "55; display:flex; align-items:center; gap:6px; }\n\n            .emo-tags { display:flex; gap:5px; margin-bottom:14px; flex-wrap:wrap; }\n            .emo-tag { padding:3px 10px; border-radius:20px; font-size:12px; font-weight:500; }\n            .hint-text { font-size:12px; color:" + T.textMuted + "; margin-bottom:8px; }\n          "}} />

          {on && cs?.position!=="center" && <div className="overlay"/>}
          {on && cs?.position==="center" && <div className="overlay-center"/>}
          {!on && <button onClick={function(){setStep(0);setOn(true);setTab("emotion");}} className="restart-btn"><span>{"\u2753"}</span> 튜토리얼</button>}

          <div className="diary-inner">
            {/* Header */}
            <div style={{ marginBottom:24 }}>
              <div className="breadcrumb"><span>{"\u{1F4D6}"} 일기장</span><span style={{ color:T.tagBorder }}>/</span><span>{dateStr}</span></div>
              <div ref={titleRef} style={Object.assign({}, hl("section-title"), { padding:10, margin:-10 })}>
                <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:6 }}>
                  <span style={{ fontSize:26 }}>{"\u{1F4DD}"}</span>
                  <input value={title} onChange={function(e){setTitle(e.target.value);}} placeholder={dateStr + " " + dayStr + "의 일기"} className="diary-title-input"/>
                </div>
                <div className="diary-date">{"\u{1F550}"} 생성일 {dateStr} {today.getHours()}:{String(today.getMinutes()).padStart(2,"0")}</div>
              </div>
            </div>

            <div className="card">
              {/* Locations */}
              <div ref={locRef} className="card-section card-divider" style={hl("section-location")}>
                <div className="section-header">
                  <div className="section-label">
                    <span style={{ fontSize:15 }}>{"\u{1F4CD}"}</span>
                    <span className="section-label-text">방문 위치</span>
                    <span className="badge">{locs.length}곳</span>
                  </div>
                  <button onClick={addLoc} className="add-btn"><span style={{ fontSize:15,lineHeight:1 }}>+</span> 장소 추가</button>
                </div>
                {locs.map(function(l){return <LocationItem key={l.id} loc={l} onRemove={function(){setLocs(locs.filter(function(x){return x.id!==l.id;}));}} onUpdate={function(u){setLocs(locs.map(function(x){return x.id===l.id?u:x;}));}}/>;
                })}
              </div>

              {/* Payments */}
              <div ref={payRef} className="card-section" style={hl("section-payment")}>
                <div className="section-header">
                  <div className="section-label">
                    <span style={{ fontSize:15 }}>{"\u{1F4B3}"}</span>
                    <span className="section-label-text">카드 결제 내역</span>
                    <span className="badge">{pays.length}건</span>
                    <span className="total-badge">총 {total.toLocaleString()}원</span>
                  </div>
                  <button onClick={function(){setUpload(!upload);}} className="add-btn"><span style={{ fontSize:13 }}>{"\u{1F4F7}"}</span> 캡처 첨부</button>
                </div>
                {upload && (
                  <div onClick={doAI} className="upload-area">
                    <div style={{ fontSize:28,marginBottom:6 }}>{"\u{1F4F8}"}</div>
                    <div style={{ color:T.textSub, fontSize:13, marginBottom:3 }}>카드 결제 캡처를 드래그하거나 클릭</div>
                    <div style={{ color:T.textMuted, fontSize:11 }}>AI가 자동 인식합니다</div>
                  </div>
                )}
                {proc && (
                  <div className="ai-bar">
                    <div className="spinner"/>
                    <span style={{ color:T.accent, fontSize:13 }}>{"\u{1F916}"} AI가 분석 중...</span>
                  </div>
                )}
                {pays.map(function(p){return <PaymentItem key={p.id} item={p} onRemove={function(){setPays(pays.filter(function(x){return x.id!==p.id;}));}}/>;
                })}
              </div>
            </div>

            {/* Tabs */}
            <div className="tabs">
              {[{k:"emotion",i:"\u{1FAE7}",l:"감정 일기"},{k:"activity",i:"\u{1F3C3}",l:"활동 일기"}].map(function(t){return (
                <button key={t.k} onClick={function(){setTab(t.k);}} className={"tab-btn " + (tab===t.k?"active":"")}><span>{t.i}</span> {t.l}</button>
              );})}
              <div className="tab-fill"/>
            </div>

            <div className="tab-content">
              {tab==="emotion" && (
                <div ref={emoRef} className="tab-inner" style={hl("section-emotion-tab")}>
                  <div style={{ marginBottom:16 }}>
                    <div className="hint-text">오늘의 감정을 선택하세요 <span style={{ color:T.tagBorder }}>(복수 선택)</span></div>
                    <div className="emo-grid">
                      {emotions.map(function(em,i){
                        var s=selEmo.includes(i);
                        return <button key={i} onClick={function(){togEmo(i);}} className="emo-btn" style={{ background:s?em.color+"18":T.tag, border:s?"2px solid "+em.color:"2px solid "+T.tagBorder }}>
                          <span className="emo-emoji">{em.emoji}</span><span className="emo-label" style={{ color:s?em.color:T.textMuted, fontWeight:s?600:400 }}>{em.label}</span>
                        </button>;
                      })}
                    </div>
                  </div>
                  {selEmo.length>0 && (
                    <div style={{ marginBottom:16 }}>
                      <div className="hint-text">감정 강도</div>
                      <div className="int-bar">
                        {intensityLabels.map(function(l,i){return (
                          <button key={i} onClick={function(){setEmoInt(i);}} className="int-btn" style={{
                            background:i<=emoInt?(emotions[selEmo[0]]?.color||T.accent)+(i===emoInt?"bb":"44"):T.tag,
                            color:i<=emoInt?"#fff":T.textMuted, fontWeight:i===emoInt?600:400,
                            textShadow:i<=emoInt?"0 1px 2px rgba(0,0,0,0.2)":"none",
                          }}>{l}</button>
                        );})}
                      </div>
                    </div>
                  )}
                  {selEmo.length>0 && (
                    <div className="emo-tags">
                      {selEmo.map(function(i){return (
                        <span key={i} className="emo-tag" style={{ background:emotions[i].color+"18", color:emotions[i].color, border:"1px solid "+emotions[i].color+"44" }}>
                          {emotions[i].emoji} {emotions[i].label} &middot; {intensityLabels[emoInt]}
                        </span>
                      );})}
                    </div>
                  )}
                  <textarea value={emoDiary} onChange={function(e){setEmoDiary(e.target.value);}} className="diary-textarea"
                    placeholder={"오늘 느낀 감정에 대해 자유롭게 적어보세요...\n\n어떤 순간에 어떤 감정을 느꼈나요?"}/>
                </div>
              )}
              {tab==="activity" && (
                <div ref={actRef} className="tab-inner" style={hl("section-activity-tab")}>
                  <div className="hint-text">오늘 한 활동들을 기록하세요</div>
                  <div className="tag-grid">
                    {actList.map(function(a,i){
                      var s=selAct.includes(i);
                      return <button key={i} onClick={function(){togAct(i);}} className="tag-btn" style={{ background:s?T.accent+"18":T.tag, border:s?"1.5px solid "+T.accent:"1.5px solid "+T.tagBorder }}>
                        <span className="tag-emoji">{a.emoji}</span><span className="tag-label" style={{ color:s?T.accent:T.textMuted }}>{a.label}</span>
                      </button>;
                    })}
                  </div>
                  <textarea value={actDiary} onChange={function(e){setActDiary(e.target.value);}} className="diary-textarea"
                    placeholder={"오늘의 활동을 기록해보세요...\n\n무엇을 했나요? 누구를 만났나요?"}/>
                </div>
              )}
            </div>

            <div className="footer">
              <span>마지막 저장: 방금 전</span>
              <div style={{ display:"flex", gap:10 }}>
                <span>{"\u{1F4CD}"} {locs.length}곳</span>
                <span>{"\u{1F4B3}"} {pays.length}건</span>
                <span>{"\u270F\uFE0F"} {emoDiary.length+actDiary.length}자</span>
              </div>
            </div>

            {on && <Tooltip step={cs} stepIdx={step} total={STEPS.length} targetRef={tr} onNext={next} onPrev={prev} onSkip={skip} containerRef={cRef}/>}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<DiaryApp />);
  </script>
</body>
</html>
